# 画像の変換と濃度値の補正  
画像の前処理として各画素の濃度・明度の調整方法、アフィン変換、画像の変換に伴う濃度値の補正について説明する。  

## 濃度・明度の調整  
**濃度画像**：画像の色成分画像、グレースケール画像  
画像データは、数学的には行列として扱うことができる。行列の各要素が濃度値になっていると見れる。  

* 画像データの表現  
**画素(pixel:ピクセル)**：画像の最小単位  
各画素にRGBなどに対応する濃度値(輝度値)が割り当てられる。  
一般的な画像は、最小値0、最大値255の256段階の8bitで表現される。  

* グレースケール化処理  

**1. RGB各成分画像の単純平均によるグレースケール化**
各画素のRGB成分の値を単純平均することによって、グレースケール画像を作成することができる。  
```math
Y=(R+G+B)/3
```
**2. 重み付き平均によるグレースケール化**  
RGBの各成分に対して重みを付けて加算する方法がある。  
よく用いられるのは、RGB表色系の画像をYIQ表色系に変換する際のY成分の値のみを用いる場合である。  
```math
Y=0.299R+0.587G+0.114B
```  
**3. RGB各成分の最大値によるグレースケール化**  
それほど使われない。各画素のRGB成分濃度値の最大値を利用してグレースケール化する方法もある。  
```math
Y=max(R,G,B)
```  
* 輝度反転処理  
画素の輝度値をI_in、変換後の値をI_outとすると、この処理は次のように表される。  
```math
I_out = 255-I_in
```  
* ポスタリゼーション  
RGBの１チャネルあたりの8ビットの量子化数を減らす処理。8bitから2bitに変換などをすることができる。  

* バイアス変更による明度の調整  
**バイアス調整**：画像全体を明るくしたり暗くしたりするために、各画素の濃度値に同じ値を加える  
各画素は0~255までの値であるので、255を超えた場合は255になる。  

* ガンマ補正  
入力電圧の変化に対して輝度値が直線的に変化しない特性を補正するため。  
```math
I_out = 255(I_in/255)^{1/\gamma}
```
* １次関数による濃淡補正  
１次関数により補正する方法。  

## ヒストグラムを用いた処理  
**濃度ヒストグラム**：画像の中の各濃度値を持つ画像がいくつあるかを表現したもの。  

コントラストの強調を行うにはいくつか方法がある。  
1. ヒストグラム伸長  
   ヒストグラムを用いる。最小、最大輝度値をそれぞれ伸長させる。
2. ヒストグラム平坦化  
   画像全体の画素値が大きく変化し、解析結果が変わる場合があるので、平坦化を行う前に重要な解析などを済ませておいた方が良い。  


## 画素位置の変換  
画像の画素の位置を変更する方法について説明する。  
画素位置の変更は、幾何学的な処理となる。  
アフィン変換：線形変換と平行移動を組み合わせた変換である。この変換を用いることにより、画像の拡大縮小、平行移動、回転変換、せん断変換、反転変換などを行うことができる。  

* 拡大縮小処理  
  * 拡大処理：元の画像になかった画素を作ることになる。その画素の濃度値をどのように決めるかが鍵である。補間方法としては、ガウス分布を利用した方法、最近傍画素の値を用いた方法、線形補間を用いた方法などがある。  
  * 縮小処理：エッジの劣化が少ないバイキュービック法、計算コストの面で優れているバイリニア法などがある。  

* 平行移動  
画像のなくなった部分の濃度値が0になり、黒い領域になる。  

* 回転変換  
一般的に画像は矩形領域で示されるため、回転することによって元の画像領域から外れてしまう部分がある。  

* せん断変換  
x軸方向のせん断とy軸方向のせん断の2種類がある。  
変換後は、元の画像よりも大きくなるため、はみ出した部分は削除される。  

これらの変換を組み合わせることで様々な変換を行うことができる。  

* 反転変換  
アフィン変換とは異なる変換を用いる。  
1. 上下反転変換  
元画像をf(x,y)、変換後の画像をg(x,y)、画像サイズをW_x×W_yとすると、
```math
g(x,y) = f(x,W_y-y)
```
2. 左右反転変換  
```math
g(x,y)=f(W_x-x,y)
```

## アフィン変換に伴う濃度値の補正  
アフィン変換を行うとき、各画素の濃度値を補正しなければならない。  
* 最近傍補間による補正  
```math
図2.16  
```
単純で高速な補間方法であるが、*ジャギー* が現れる。  
*ジャギー*：滑らかなエッジが、補間後にギザギザになること。  

* 双１次補間による補正  
よく利用される。変換結果が滑らかであり、計算コストが低く、高速に実行できること。  
```math
図２.17
```
最近傍補間に比べてジャギーは少なくなるが、その分エッジ情報が失われる可能性がある。画質がそれほど問題にならない場合は十分である。  

* 双3次補間による補正  
```math
図2.18
```
求めたい画素の周りの16近傍の画素値を用いる方法。非常に優れた性能をもつ。  
　

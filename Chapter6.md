# 2値化とモルフォロジー演算  
画像に写っている対象物と背景を2値化によって分離する方法を説明する。２値化画像は、形状抽出や特徴量解析の際に必要になる。  
モルフォロジー演算：２値化画像には画像の前処理で除去できなかった大きな雑音や、フィルタ処理で除去できない種類の雑音が残っているため、これらの雑音を除去する方法  

##　固定閾値法による２値化  
ある閾値を設定することによって、その閾値を境に画像を0(黒)、255(白)の２値に分ける操作のこと。  
固定閾値法：画像全体に対して1つの閾値をする方法。まず、濃度画像(グレースケール画像)のヒストグラムを作り、次に対象物と背景を分ける閾値を決定する。この閾値は、結果を見ながら対話的に試行錯誤によって決めていく。画像の枚数が少なく、撮影条件が一定のときなどは、有効。  
撮影条件の変化に対応するには、次節で説明する自動閾値決定法を用いる。　　

## 自動閾値決定法による2値化  
pタイル法、モード法、判別分析による方法について説明する。  
* pタイル法  
画像中の対象物の大きさの割合がp%であるとわかっている時によく使われる。  
閾値には、濃度画像(グレースケール画像)の濃度ヒストグラムにおいて最大値からの累積度数がp%になった時の濃度値を選ぶ。古くからよく用いられている。  
**pタイル法**  
次のような画像に対して有効である。  
1. 対象物の画像中での面積比率がわかってる。  
2. 対象物を構成する画素の濃度値(輝度値)が、ある範囲に集中している。  
3. 対象物に対応する濃度値範囲と他の物体の濃度値範囲が分かれている。  

* モード法  
濃度画像(グレースケール画像)の濃度ヒストグラムが双峰性を持つ場合の手法。一般に2つの局所的最大値の間には、１つの局所的最小値が存在する。その局所的最小値の濃度値を閾値として2値化を行う方法で最頻値(モード)を利用している。  
モード法は以下のような画像が有効。
1. 濃度値によって画像を対象物と背景に明確に分離できる。
2. 濃度ヒストグラムが前景と背景の双峰性を持つ。  

* 判別分析に夜2値化  
はっきりとした双峰性がない場合は、モード法はそぐわない。そのような場合にも利用できる自動閾値決定法が提案されている。大津の２値化法について説明する。  
閾値tで２値化する時、閾値よりも濃度値が小さい側の画素数をw1、平均をm1、分散をσ1^2、濃度値が大きい側の画素数をw2、平均をm2、分散をσ2^2、画像全体の画素数をwt、平均をmt、分散をσt^2とした時、クラス内分散σw^2は次式で表すことができる。  
```math
σw^2=(w1σ1^2+w2σ2^2)/(w1+w2)
```
クラス間分散σb^2は、
```math
σb^2=(w1(m1-mt)^2+w2(m2-mt)^2)/(w1+w2)=(w1w2(m1-m2)^2)/(w1+w2)
```
として表すことができる。  
ここでの全分散σt^2は、
```math
σt^2 = σb^2+σw^2
```
として表すことができるので、求めるクラス間分散とクラス内分散との比である分散度は次のようになる。  
```math
σb^2/σw^2=σb^2/(σt^2-σb^2)
```
全分散は閾値に関係なく一定なので、クラス間分散が最大となる閾値を求めれば良いことがわかる。クラス間分散の式の分母も閾値に関係なく、一定なので、分子が最大になる値を求めれば良い。  
大津の２値化法のアルゴリズムは次のようになる。  
1. 画像の濃度ヒストグラムを作成し、2値化のための閾値をk*とする。  
2. 初期閾値をk*=0にする。  
3. 閾値をk*とした時のクラス間分散σb^2を計算する。  
4. 閾値をk*+1→k*として、step3を繰り返し、クラス間分散σb^2が最大となる時のk*を閾値に決定する。クラス間分散の最大値σb^2(k*)を画像全体での分散σt^2で正規化した係数は、値が１に近いほど、２クラスの分離度が高いことを示している。  

* 大津の２値化の応用  
大津の方法をさらに改良した方法。ここでは、その中で特によく知られているものを説明する。  
1. Kittlerの方法  
大津の２値化法では、２クラス分布割合が極端に異なる場合、背景に比べて前景(対象物)の面積が極端に小さい場合に、対象物の面積が実際よりも大きくなるような閾値が選ばれるという性質がある。この欠点を改善するために考えられた方法。  
評価関数に対数を加えることで、背景と前景の面積が極端に違う場合に対応する。  
2. ラプラシアンヒスグラム法  
濃度画像の濃淡変化のあるエッジの上部(明るい側)と下部(暗い側)でラプラシアンの絶対値が大きくなることを利用した方法。  
この方法も背景と対象物の面積差が大きい場合に用いられる。  

## 動的閾値決定法  
画像の撮影の場合、加奈wずしも同一条件で撮影することはできない。特に、照明については、不均一な濃度レベルになる場合があり、このような濃度不均一な画像に対して固定閾値処理を行うと、部分的に塗りつぶされた画像になることがある。自動閾値決定法を行なっても得られるのは固定閾値なので、同様の課題が残る。  
* 移動平均法   
注目画素の濃度値と、その近傍の局所的平均値との比較によって２値化を行う方法。  
近傍サイズとしては、少し大きめの値にすることが多い。注目画素と、近傍領域を１画素ずつ移動させて、２値化を行なっていく。近傍領域を大きめに取るため、画像の周辺部分に処理ができない帯状の領域ができるので、周辺部分については処理方法を変える必要がある。  

* 部分画像分割法  
画像全体を複数の部分画像に分割し、それぞれの部分画像で最適閾値を決定する。画素ごとに閾値を調整するために、次のアルゴリズムで処理が行われる。  
1. 画像を小領域に分割する。  
2. 
